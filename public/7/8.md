2019年的第一篇文章，我写的是一篇实景照片合成三维动画的制作案例：

[](https://zhuanlan.zhihu.com/p/54140065)

其实苦七不仅一次给我提议多弄点实景三维合成的内容，虽然网上相关的教程很多，但是还是很好玩。

**我其实之前也尝试过好几次使用C4D来制作实景视频合成，但是感觉C4D的运动跟踪功能真的很容易不准，所以也就一直没有写出来。**

大家知道我最近不是在学习AE么，然后我用AE尝试了一下，感觉摄像机反求出来的效果会比C4D要好。

**所以，今天我们来看看如何用AE结合C4D做一个实景视频三维合成的内容吧。**

![](https://pic2.zhimg.com/v2-29972d51c8ff091e19931910625efd1d_r.jpg)

首先给大家简单说明一下我对实景三维合成浅显的理解吧！

**实景三维合成大体可以分为静态素材三维合成和动态三维素材合成，根据素材的情况不同，我们会采用不同的方法来制作。**

**1、静态素材三维合成**

静态素材三维合成可以采用C4D的摄像机校准功能来制作，详细方法请看今年的第一篇文章。

**2、动态素材三维合成**

动态素材三维合成其实就是我们常说的摄像机反求，又可以分为对象静止摄像机运动或者对象运动（摄像机运动与否均可）。

对象静止摄像机运动这种是最容易跟踪的，我们可以采用C4D或者AE的运动跟踪来制作，对于平面的跟踪我们还可以使用Mocha。

对象运动我们可以使用C4D的对象跟踪或者一些专门的摄像机反求软件，这些专业的软件我就没有太了解了。

**并且这里说的对象运动，仅仅指的是对象做移动旋转的运动。**

**如果是复杂的变形运动，这个需要前期的硬件支持，也就是运动捕捉，这类复杂的摄像机反求仅仅靠后期软件是达不到的。**

由于摄像机反求原理其实还是软件对于素材画面的特点进行计算，所以前期拍摄的要求还是有一定要求的，画面颜色、运动程度、镜头畸变等都会影响到摄像机反求的结果。

![](https://pic2.zhimg.com/v2-29972d51c8ff091e19931910625efd1d_r.jpg)

**大概简述这么多吧，进入今天的正题之前，我们先要在C4D官网下载这么一个免费的C4D和AE互导的插件。**

当然我这里也已经下载好了，文后会分享给大家，虽然官网上写的C4D版本是R17，不过经测试我用的R18也是可以使用的：

![](https://pic2.zhimg.com/v2-2b91f0925e51b94377984c742cb825fd_r.jpg)

win版和mac版都有，win版只需要把它们放进AE的插件目录里就可以了，mac版的童鞋请自行测试哦：

![](https://pic1.zhimg.com/v2-29597beaaba93e2d1c34fcbcb3e1b140_r.jpg)

然后下面是我自己随意的在家附近空地拍了很短的一段视频素材：

![](https://pic2.zhimg.com/v2-842024606f72fd5d55cc84aa61417f95_r.jpg)

可以看到我拍摄的时候有点抖动，这样可能会对我们进行摄像机反求的操作有干扰，所以我这里先导入AE使用变形稳定器对素材进行了简单的处理：

![](https://pic4.zhimg.com/v2-b54c8fec8a68305fc95fb04e8d96581f_r.jpg)

再将稳定后的视频导出png序列：

![](https://pic1.zhimg.com/v2-db3bfaf73969f48cc03ff4695ca801f4_r.jpg)

稳定以后的素材会损失掉一些画面，但是整体画面就会比较平稳：

![](https://pic2.zhimg.com/v2-80a1c42d789fa0d1c69277525dc62315_r.jpg)

接下来就是进行摄像机反求了，导入稳定后的素材，选中以后鼠标右键选择跟踪摄像机：

![](https://pic3.zhimg.com/v2-9ece27588b01be4da83a7e64c76de9be_r.jpg)

跟踪完毕以后，画面中就会出现很多跟踪点，有时候你可能会看到当你要选择跟踪点的时候。

**它会提示你没有来自三脚架全景解析的深度，具体原因我不太确定，可能是素材的原因吧：**

![](https://pic2.zhimg.com/v2-3783096def960959c5abfc178126634d_r.jpg)

没关系，我们打开3d相机跟踪器的高级，将解决方案选择为"经典"就可以了：

![](https://pic1.zhimg.com/v2-f5db14b0b6faf49ed6b24cd4c6cf74ec_r.jpg)

接下来这一步很重要，按住康秋键，尽量的选择三个在同一平面上的点，通过目标圆盘我们可以来判断它们是否在一个平面上。

**然后鼠标右键选择设置地平面和原点，因为我们后面需要导入C4D去添加三维元素，这一步是为了确定世界坐标原点：**

![](https://pic3.zhimg.com/v2-6f6dd8afb314f4917e93882e002469da_r.jpg)

设置地平面和原点以后，再次鼠标右键创建实底和摄像机：

![](https://pic4.zhimg.com/v2-7085540502e9c4767c11c684dd18e503_r.jpg)

这个时候画面中就会出现一个跟踪实底：

![](https://pic3.zhimg.com/v2-e69670cf503e0cf23322100a255d05c2_r.jpg)

这个时候我们可以通过对跟踪实底进行旋转，放大以及降低不透明度，然后点击播放键看一下平面是否有滑动，如果没有滑动的话就表示跟踪是准确的：

![](https://pic3.zhimg.com/v2-29d5c62b676554b608bdd8ba418d82ce_r.jpg)

感觉没有问题了，就需要把AE里计算出来的摄像机等信息导进C4D里操作了，执行文件-导出-CINEMA 4D Exporter：

![](https://pic3.zhimg.com/v2-a57d5cbd587d10e1e26550a4dde11392_r.jpg)

接下来就是在C4D里操作了，打开从AE导出来的C4D文件，你可能会觉得尺寸太大了，所以我这里整体把尺寸缩小了10倍：

![](https://pic2.zhimg.com/v2-914fa7269a8f6f432f9dc57726af96c5_r.jpg)

可以再新建一个人偶测试一下，感觉把人偶的尺寸再放大12倍就差不多了：

![](https://pic3.zhimg.com/v2-ad180b263ffa25ba6a3509afe1aa5f7a_r.jpg)

接下来就是场景的重建，添加灯光然后进行分层渲染了，由于鹿友们总是说我用OC渲染器，mac版的童鞋们用不了。

**所以我今天打算先用默认渲染器简单的演示一遍，没有OC的鹿友们可以知道用默认渲染器的大概流程，然后最终的成品，我还是选择用OC，毕竟会快很多。**

假设我们要在场景中添加的就是这个人偶，首先新建一个背景，同时新建一个材质球赋予背景：

![](https://pic1.zhimg.com/v2-97f62440046fef3d2062dae37cbdcbb0_r.jpg)

双击材质球，只勾选颜色通道，然后加载我们稳定后的动画序列：

![](https://pic1.zhimg.com/v2-a300da15c248748a5aa1b13057e197c4_r.jpg)

进入贴图的二级页面，在动画面板点击一下计算：

![](https://pic3.zhimg.com/v2-9444e90fd0be0d1b86c32ddaafc4174a_r.jpg)

点击编辑，勾选动画预览，预览的尺寸可以改大一点：

![](https://pic1.zhimg.com/v2-85db254da2454767689ac8758c4fd2a0_r.jpg)

**我们这个场景其实是很简单的，场景重建的话只需要一个平面就可以了，新建一个平面用于接收投影面，可以对比着跟踪实底调整它的位置和大小。**

把加载了动画序列的材质球拖给平面，投射方式为摄像机贴图，把解析好的3D跟踪器摄像机拖到摄像机栏位，点击一下计算：

![](https://pic2.zhimg.com/v2-cd595e56a44df6b908de5b4ecbd82539_r.jpg)

这个时候康秋R渲染一下，你会发现地面黑黑的一片：

![](https://pic3.zhimg.com/v2-88480ee4b0aba154216e7c9130b23eea_r.jpg)

没关系，给平面添加一个合成标签，勾选合成背景就可以了：

![](https://pic1.zhimg.com/v2-0784c6e5536e6effb884c0e5939ee120_r.jpg)

接下来就是添加灯光，开启衰减和投影了，由于我们这里的对象没有上材质。

**如果是有反射一类的材质的话，你还可以考虑新建天空贴发光材质加载HDR贴图来添加环境光，我们这里只是说明流程，就不细化了：**

![](https://pic4.zhimg.com/v2-1283d46690327ec0f3b17550f9012dc7_r.jpg)

另外投影的位置这里再啰嗦一句，尽量的参考场景中已有的投影的位置和长度来弄灯光，这样会比较真实一点：

![](https://pic3.zhimg.com/v2-39331982891b476908aeba2f8207c426_r.jpg)

当我们场景、材质、灯光都搞好了以后，就可以给对象添加合成标签勾选对象缓存，进行分层渲染后期到AE或者PS里去进行合成，例如我这里人偶的对象缓存是2，地面的对象缓存是1：

![](https://pic2.zhimg.com/v2-e8f15a2d8c0cb0e14d01828926807b51_r.jpg)

渲染设置中，多通道渲染就根据你实际的场景以及材质选择就好，例如我们需要投影就勾选投影，分层渲染以后的操作请看我们OC部分后面的合成部分：

![](https://pic4.zhimg.com/v2-c9b6d93477c8a97d539ae844705c3553_r.jpg)

好了，终于到了OC部分了，我这里删掉了材质灯光等，只留下了一个平面，然后导入了一个跳舞的动画模型，当然大家也可以自己去做一些有趣的动画：

![](https://pic1.zhimg.com/v2-8eacd82f9554c5c5464af1a149908048_r.jpg)

新建一个环境光用于照明，由于OC不支持C4D自带的背景，所以新建一个平面放到地面的后面：

![](https://pic1.zhimg.com/v2-c2fb9b99f43f31e42d8167519d710d90_r.jpg)

因为OC的摄像机其实就是C4D自带的摄像机上多了个OC的摄像机标签而已，所以添加个标签吧：

![](https://pic2.zhimg.com/v2-76b770106ec7abd4e4f360f60206f42d_r.jpg)

同样新建OC的漫射材质球，漫射通道加载动画序列，二级页面点击动画面板点击计算：

![](https://pic3.zhimg.com/v2-7661838de439c9e20c3354b07b0e9d96_r.jpg)

点击编辑，勾选动画预览，预览的尺寸可以改大一点：

![](https://pic1.zhimg.com/v2-fd6b7e76613dd57c4b0fc4f7d0edbea0_r.jpg)

把材质球赋予地面和背面，将投射方式改为摄像机贴图，把摄像机拖进去，由于我们素材的宽高比是16：9，所以影片比例选在为16：9：

![](https://pic3.zhimg.com/v2-2b95d64708f214c463e6c015658f20e2_r.jpg)

新建太阳光，然后通过调整强度，旋转以及颜色等，让对象的投影看起来整体和谐：

![](https://pic2.zhimg.com/v2-2e14488611877bfa2394ebb0179cf705_r.jpg)

对于跳舞对象的处理大家凭自己喜好吧，之前正好有一位鹿友问了一个人物线条的问题：

![](https://pic1.zhimg.com/v2-2e010a35b28100fabbdc7956004eda20_r.jpg)

**做法可能不一样，我这里就借用这个效果啦，首先给人物模型添加追踪对象。**

追踪模式为连接所有对象，样条类型为B样条，点差值方式为自然：

![](https://pic2.zhimg.com/v2-6323ed3aee726c1c978b6ddf1bfb37d9_r.jpg)

新建立方体，克隆对象克隆立方体，克隆模式为对象，以跳舞人物为对象进行克隆，分布为表面，数量大家看着办就好：

![](https://pic4.zhimg.com/v2-775c70be9fe2369ab79698f21a8c1daf_r.jpg)

再次给克隆对象添加追踪对象，追踪模式为追踪路径，限制改为从结束，总计的数字用于控制舞动出来的样条持续时间，样条类型为B样条，点差值方式为自然：

![](https://pic2.zhimg.com/v2-6dc556ff8b55c1c107d66426abc6a76d_r.jpg)

给两个追踪对象添加OC的对象标签，勾选渲染毛发，并且毛发栏位可以控制毛发的粗细：

![](https://pic4.zhimg.com/v2-7aafe855928b0b5e57bf3d7b9c0ba8c7_r.jpg)

**这里补充一个之前那位鹿友遇到的问题，你可能在渲染预览窗口是可以看见克隆在人物身上的立方体追踪出来的样条，但是渲染单帧到图片查看器的时候却没有。**

这个是由于立方体追踪出来的样条是一个运动的状态，所以渲染单帧到图片查看器是看不到的，当你渲染全部帧就有了：

![](https://pic3.zhimg.com/v2-bef207766259dba05c3d66a108efad7a_r.jpg)

人物的材质方面我这里就是很简单的弄了两个反射材质，然后用混合材质进行混合，通过一个Dirt节点来控制颜色的范围：

![](https://pic1.zhimg.com/v2-47d6898b449f35fe882f1af824805fa4_r.jpg)

差不多就可以进行分层渲染的设置了，两个追踪对象的对象标签对象缓存ID填为2：

![](https://pic4.zhimg.com/v2-0f291e6813e74c4eac491b6c3f7c341b_r.jpg)

给地面添加对象标签，对象缓存ID填为3：

![](https://pic2.zhimg.com/v2-a9b434fb7e0f09a3b7bcd115b9001745_r.jpg)

渲染设置里将多通道渲染启用，选择一个保存的位置以及格式，然后根据自己的材质情况勾选需要分层渲染的通道，例如我这里勾选了漫射，反射以及投影，同时勾选对象缓存2和3：

![](https://pic4.zhimg.com/v2-98f9649ee7ffd8a3fb35612877bc2717_r.jpg)

保存面板也需要设置一个保存的地址，别忘记在输出面板选择渲染全部帧，这样就可以渲染出图了：

![](https://pic1.zhimg.com/v2-48b1610f2ef0aa09fd3f033da9743994_r.jpg)

**接下来就是把渲染出来的主图以及分层全部导入AE里去合成了。**

最下方放我们最初稳定后的素材，上方放C4D渲染出来的主图，可以明显看到地面违和的地方：

![](https://pic3.zhimg.com/v2-6bd764b39045abf10f3166af9640a862_r.jpg)

没关系，由于我们渲染的人物对象缓存，所以把人物对象缓存放到主图的上方，然后让主图以对象缓存的亮度作为蒙板，这样违和的地方就被搞掉了：

![](https://pic3.zhimg.com/v2-3f440400499786ccef7e45c183ee0a92_r.jpg)

我觉得人物颜色太浅了，所以把渲染出来的漫射层放下来，同样通过对象缓存把漫射层的人物抠出来，漫射层的混合模式为叠加，适当的降低不透明度：

![](https://pic4.zhimg.com/v2-8663e25575dc7f1c3e140223cb7adbb3_r.jpg)

当然如果你的材质是有反射材质的，也可以把反射层弄下来，不过我这里的反射效果就不太明显了，混合模式大家看着办吧：

![](https://pic4.zhimg.com/v2-69ff2a9eae5af096568666ffa13f23c3_r.jpg)

最后是把投影层放在原始素材层的上方，混合模式为相乘，降低一点不透明度，这样基本就搞定了。

**如果你使用的是默认渲染器，导入AE里的操作原理是一样的哦，大家可以动手去试试：**

![](https://pic3.zhimg.com/v2-e0855de1b4cb3c5938eccc4630ec1816_r.jpg)

最后我又剪了几个舞蹈进去渲染出图看看效果吧：

[![](https://pic1.zhimg.com/v2-754976344e34f1c37c6d43e8a665c03a.png)](https://link.zhihu.com/?target=https%3A//www.zhihu.com/video/1187289975387877376)

又是一篇篇幅很长的文章，其实摄像机反求虽然很多时候可能会跟踪不准，但是操作上并没有什么难点，并且很容易做出一些有趣的效果。

**再来梳理一下今天的步骤流程吧：**

1、使用AE对拍摄的视频素材进行稳定处理以后，对素材进行摄像机跟踪，设置好要作为C4D的世界坐标原点以及地面，创建地面实底和摄像机，然后导出C4D文件。

2、C4D中进行场景重建，场景重建并不是所有的场景都需要重建，只需要重建会与加入的三维对象发生交互的部分，如本文中只需要重建地面。

3、上材质，补光，这里用默认渲染器或者OC渲染器都可以，补光尽量的参考素材本身的光源情况来进行补光，然后添加合成标签（OC的对象标签），设置对象缓存，漫射层以及投影层等做分层渲染。

4、最后再次导入AE，利用蒙板来进行最终的合成。

**希望各位鹿友能够通过今天的分享对于动态素材三维合成（摄像机反求）的整体流程有个了解，下来以后可以自己多做尝试，下面是今天的视频版：**

[![](https://pic1.zhimg.com/v2-53e45b2084d7eca3305a9d39c326c3ce.png)](https://link.zhihu.com/?target=https%3A//www.zhihu.com/video/1187290067688656896)

好啦，今天的分享就到这里，想要插件，源文件以及原视频的童鞋后台**撩我**获取吧！

**更多内容欢迎关注公众号**

公众号：野鹿志

老鹿微信：maluyelang6666

苦七微信：766057766

本文由“野鹿志”发布

转载前请联系马鹿野郎

私转必究