![](https://pic3.zhimg.com/v2-dbe1c9d14a8a91291e30d279d2c58cfe_r.jpg)

国庆前再赶一篇出来，所以提前预祝各位鹿友国庆快乐吧！

继续临摹吧，同样来自INS大神**@BastardFilms：**

![](https://pic3.zhimg.com/v2-82ee997ca27d76eaa64e4086ab74700a_r.jpg)

同样我这里加速了一下然后压缩成了动图，大家看看吧：

![](undefined)

原作者说的是使用了XP4.0模拟布料，然后再结合XP的纹理发射：

![](https://pic1.zhimg.com/v2-0140a4215d3430ba29f1d390f50fe3c8_r.jpg)

这个粒子扩散然后又汇聚的效果我当时看到的时候觉得会做，但是实际尝试的时候才发现当中有很多细节需要注意。

**所以今天的文章我想把制作过程中自己的思考以及按照自己的思路制作时遇到的问题都写出来。**

这样我觉得比直接告诉大家尝试后的操作要好一些，希望这样大家会有一些收获。

**好了，今天我们就来制作一个布料飘散汇聚的动画吧！**

![](https://pic2.zhimg.com/v2-29972d51c8ff091e19931910625efd1d_r.jpg)

00

**制作之前的思路**

开始之前先说说我的思路吧，首先我还是会按照原作者说的用XP4.0来模拟布料的形态。

**虽然XP模拟布料的原理也是通过粒子来控制多边形的形态，但直接使用模拟布料的粒子来制作图画粒子飘散的效果好像无法实现。**

因为它粒子的发射模式只能是基于模型的点发射，不能基于纹理发射，并且我尝试过使用颜色修改器好像纹理贴上去也是有问题的。

**所以我的想法是先用A发射器制作布料形态，然后再用B发射器在基于现有布料形态的基础上进行纹理发射并且飘散汇聚。**

接下来我们就一步一步的看这个我的这个思路是否可行吧。

![](https://pic2.zhimg.com/v2-29972d51c8ff091e19931910625efd1d_r.jpg)

01

**XP布料模拟部分**

首先准备一张图画的素材，刚好我朋友家的小孩最近画了一张，就被我征用了：

![](https://pic1.zhimg.com/v2-9588c904aa329a7e57b4472d1d09bb70_r.jpg)

打开C4D新建平面，因为我将素材需要的部分裁剪出来的尺寸是642\*864，所以新建平面尺寸保持一致，分段略微提高一点就行了：

![](https://pic4.zhimg.com/v2-ab656b2e6c5c76ca76a9bccbc93e524b_r.jpg)

新建材质球，在颜色通道加载贴图，编辑里可以将预览尺寸稍微改大一点：

![](https://pic2.zhimg.com/v2-b02b58fa51071b25ec07cc49fe2af4a5_r.jpg)

**然后我这里自己做了一个简易的相框模型，因为这个不是我们今天分享的重点，所以就不写制作过程了。**

大家可以自己做或者文后获取源文件就可以了，反正就是挤压挤压再挤压：

![](https://pic3.zhimg.com/v2-29bc3e371db6e0101d3080d387ff8556_r.jpg)

相框添加布料曲面增加厚度：

![](https://pic4.zhimg.com/v2-223e0ba48e5e9ce3a5c37ef5c5856653_r.jpg)

再添加一个倒角变形器吧，参数大家看着给就好：

![](https://pic4.zhimg.com/v2-62df3da8736b14afba9e942f1905204b_r.jpg)

给相框添加XP碰撞标签，碰撞模式改为Any，反弹摩擦这些地方都关掉：

![](https://pic2.zhimg.com/v2-8fd046b1d2d6de9176c2bac45d323d51_r.jpg)

我们后面需要把画的四个角固定住，所以将平面C掉以后选中四个角的点设置为选集：

![](https://pic4.zhimg.com/v2-1f61f28b29767ac93d5c54d2a46b6aeb_r.jpg)

接下来给平面添加XP布料，添加以后场景会默认添加一个重力场，我们不需要它可以直接关掉：

![](https://pic2.zhimg.com/v2-8774a3ef862de7fe11648c7663f18dc9_r.jpg)

布料标签的高级里勾选钉，然后把刚才设置的点选集拖进去：

![](https://pic1.zhimg.com/v2-fffadddf7d311ef1cae5ad45fea00b54_r.jpg)

给场景添加湍流场，参数适当的改大一点就好：

![](https://pic1.zhimg.com/v2-cc426f4cdc99b12a550939213ee31a88_r.jpg)

接下来就适当的去调整一下布料的参数吧，其实我这里没有太多改动，就是只是把布料的斜切等三个参数都改到了50：

![](https://pic3.zhimg.com/v2-3f1f592ddc95fdd7f4c06a3cc276875e_r.jpg)

02

**粒子基于布料形态飘散**

**其实布料到这样我觉得就差不多了，接下来就是我之前的思路，用另外一个发射器来基于现有的布料形态上发射粒子，让我们来看看是否可行吧。**

再新建一个发射器，发射模式改为对象，把布料平面拖进去，发射源来自纹理：

![](https://pic1.zhimg.com/v2-a0acb05f2758a46d547a5fea3ff2203c_r.jpg)

把纹理拖进去，发射源选择为无，颜色让它基于纹理的颜色：

![](https://pic3.zhimg.com/v2-5216d3b07818d5a7f317c90e19011d7a_r.jpg)

发射器的模式改为射击，让它只发射一帧，数量先暂时给到5W吧，将速度改为0：

![](https://pic3.zhimg.com/v2-60ef6884bcdb65caf5cdf87dc8c128f2_r.jpg)

不要忘记把添加布料的XP约束和湍流场都排除一下，点击播放，发现粒子并没有运动：

![](https://pic4.zhimg.com/v2-95497a36c57397358bf60d061ce7ec23_r.jpg)

回到发射器的对象里，勾选将粒子固定在发射源上，这样点击播放键粒子就会随着布料形态运动了，截至到目前看起来思路应该没有问题：

![](https://pic4.zhimg.com/v2-8e2caf27828766114b6a2ccb11714453_r.jpg)

先暂时取消一下粒子固定发射源的勾选，再次新建一个湍流场，参数大家还是看着调整吧，这个主要就是控制后面粒子飘散的形态：

![](https://pic4.zhimg.com/v2-f75d7280a46333c7c76af9d5fbf1ca37_r.jpg)

布料的发射器里记得把这个湍流场排除一下：

![](https://pic1.zhimg.com/v2-62b12882ba484c35b671bcced32861b8_r.jpg)

现在我们要做的就是让粒子再发射一段时间以后断开粒子固定发射源，首先我们想到的可能是在这个参数的勾选上K帧，但是你会发现直接K帧没有效果：

![](https://pic4.zhimg.com/v2-4479d25bd60e22576203c273aa78283b_r.jpg)

为什么没有效果我也说不好，不过我们可以这么操作一下，在发射器里添加一个问题：

![](https://pic2.zhimg.com/v2-d5aac83fdec88bf1725878c9a3c4b425_r.jpg)

问题里你可以设置一个时间，然后再添加一个动作：

![](https://pic1.zhimg.com/v2-f1b76f5d42d4f7a819641d05bf41e1cc_r.jpg)

在动作里添加断开固定发射源，这样粒子就会在你设置的时间断开固定发射源，然后受到湍流场的影响飘散开：

![](https://pic2.zhimg.com/v2-ebfdc77d57cc319a818880c15031f529_r.jpg)

**但是直接这样断开操作感觉形态比较突兀，如果能有一个衰减变化就好了，使用问题这种方式无法添加衰减。**

所以我们这里换一种方法，删掉问题和动作，我们这里可以添加一个触发动作修改器：

![](https://pic2.zhimg.com/v2-0f925279801c7a53ff078f14b1b0d519_r.jpg)

触发修改器里我们同样可以添加这个断开固定发射源：

![](https://pic4.zhimg.com/v2-4d0fe70bded4101f91be5dc1494629f7_r.jpg)

但是触发修改器是可以添加衰减的，所以我们这里可以添加一个着色器域，着色器里添加噪波，噪波类型大家随意，可以给一点动画速率：

![](https://pic1.zhimg.com/v2-c2622088f6498b9c5edf0599fcbf8e3c_r.jpg)

**然后我们可以在亮度值上K关键帧，噪波黑色代表没有，白色代表有。**

所以我们可以让亮度在45帧的时候为负100纯黑，然后在125帧的时候正100纯白，这样就有一个很舒服的过渡了：

![](https://pic2.zhimg.com/v2-942323f3158c826a6e05b013abb23ce1_r.jpg)

03

**粒子飘散后汇聚成图案**

**粒子基于布料形态飘散做好了，接下来就做汇聚图案了。**

首先我这里给控制粒子飘散的噪波场也添加了一个着色器域衰减，同样的道理在亮度值上K帧，让它在125帧的时候纯白，然后135帧的时候纯黑，代表没有噪波场：

![](https://pic3.zhimg.com/v2-f02dd1bf4688480906b97117c34c621a_r.jpg)

然后添加一个覆盖场，将活动改为纹理，把纹理标签拖进去，阈值改为纯黑色，然后勾选混合颜色，这样粒子汇聚成图案的基本形态就出来了：

![](https://pic4.zhimg.com/v2-1e2c7ce35c6f60e72e45f417b2b8a19f_r.jpg)

同样我给覆盖场添加了一个着色器域的衰减，亮度值的125帧是纯黑，135帧的时候纯白，这样我觉得过渡会稍微好一点：

![](https://pic4.zhimg.com/v2-5db89436b4ad1ed0a9534afa079296ff_r.jpg)

最后还有一点点小问题，粒子在汇聚的时候，部分粒子会留在相框的四边以及底部：

![](https://pic4.zhimg.com/v2-2d098a13bb3f1893da28d2c0125f37cf_r.jpg)

这里我们可以首先添加一个限制修改器，让粒子受到湍流场影响的时候Y轴只在正方向上运动，这样就可以避免相框的底部会有粒子的情况：

![](https://pic2.zhimg.com/v2-7678beb3bb1efd553882d9f6e90b9d45_r.jpg)

四边残留的粒子我暂时没有什么更好的办法处理，于是就加了四个杀死场搞掉不需要的粒子：

![](https://pic1.zhimg.com/v2-5b00b9dccf3c7b86ab7a2b6dbab94cf8_r.jpg)

这里补充一下，过程中在布料的发射器里把控制粒子飘散汇聚的修改器都排除：

![](https://pic4.zhimg.com/v2-046fd6b204306aa98144e766feacb32f_r.jpg)

最后我把粒子的数量提升到了40W：

![](https://pic3.zhimg.com/v2-83e03f4281c281dee14db4faae0b70c2_r.jpg)

感觉差不多就可以将粒子进行缓存了，缓存时间其实不长，但是体积挺大的，有5个多G，毕竟粒子数量有那么多：

![](https://pic2.zhimg.com/v2-30c2a46b29ae40fcfd78624dc16c7cb9_r.jpg)

04

**渲染部分**

接下来就是渲染部分了，其实我觉得没有太多可说的，渲染我并没有做的多复杂，先新建一个大大的平面当作墙壁：

![](https://pic3.zhimg.com/v2-e763eb0145c4f928b6d257afda502586_r.jpg)

设置渲染尺寸，打开GI，这些都不用说哈：

![](https://pic1.zhimg.com/v2-16a71c81f68ae934d7dde1def91d58c0_r.jpg)

新建摄像机固定渲染视角也不用说：

![](https://pic3.zhimg.com/v2-5ea6ffdcf783b8435072215d85360bf2_r.jpg)

新建环境光，不多说不多说：

![](https://pic4.zhimg.com/v2-b61b6fa0166a026805311a8637b97997_r.jpg)

给粒子飘散的发射器添加RS对象标签，模式选择为优化球体，适当的修改一下粒子尺寸：

![](https://pic4.zhimg.com/v2-e0582897cf5a498b7c85a499b61de65b_r.jpg)

粒子的材质我用的是RS预设的纸的材质，然后用用户数据节点读取粒子的颜色链接到漫射颜色上：

![](https://pic4.zhimg.com/v2-7c9fa8264a9d0eb3d57fa04d06c4e827_r.jpg)

相框的材质首先中间的面我单独上了一个RS的预设纸材质：

![](https://pic4.zhimg.com/v2-3fdc0cd3627db161a48cc61fca34f917_r.jpg)

然后边框我是在魔顿网上下载的一套木纹纹理直接上上去：

![](https://pic4.zhimg.com/v2-3f1809f1d20cbd213da074fbb33af433_r.jpg)

墙壁我就直接用的RS的噪波做了一点凹凸：

![](https://pic3.zhimg.com/v2-1095b7e92a463c6144178b4e1ca2c092_r.jpg)

视情况补了两盏灯：

![](https://pic3.zhimg.com/v2-0c36dff5534480e0407c29841a5020aa_r.jpg)

渲染时长还挺长的，接近16个小时：

![](https://pic2.zhimg.com/v2-5b23444a3869f876e390b67047ed1a95_r.jpg)

最后看看效果吧：

[![](https://pic3.zhimg.com/v2-33bc95aeab41db75921a3c9efc796d74.jpg?source=382ee89a)](https://link.zhihu.com/?target=https%3A//www.zhihu.com/video/1426909014425169920)

**动图压缩的很厉害，要是前面布料的时长再长一点，然后覆盖场开始的时候湍流场再晚点消失形态应该还要好一点，不过这样渲染的总帧数可能会更长。**

不过就这样吧，下面是今天的视频版：

[![](https://pica.zhimg.com/v2-104babeb5631c8122c0231db403d3cd6.png)](https://link.zhihu.com/?target=https%3A//www.zhihu.com/video/1426909052622802944)

基本上就是这些吧，好啦，今天的分享就到这里。

更多内容欢迎关注公众号：

公众号：野鹿志

老鹿微信：maluyelang6661

苦七微信：766057766

本文由“野鹿志”发布

转载前请联系马鹿野郎

私转必究