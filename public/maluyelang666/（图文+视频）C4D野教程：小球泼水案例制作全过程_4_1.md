![](https://pic3.zhimg.com/v2-a3093ab0291c9ac0a915a36bcdc315ca_r.jpg)

上一篇文章刚说最近有点闲工夫，结果就开始忙的要死，之前在别的公众号里看到了一个流体的效果：

![](https://pic1.zhimg.com/v2-567a77ba9eb1ef4badf66aa8a5d722bc_r.jpg)

我把它压缩成动图大家一起来看看吧：

![](https://pic4.zhimg.com/v2-f710c159b8e375a9eb6f9ecbe2a180a3_r.jpg)

**是的，这个本来是一个很常见的效果，无论是液体小球还是方形的液体，网上已经有不少类似的教程了。**

我之前也写过一个类似的方形波浪效果，不过被我做成了“厚浪”：

![](https://pic4.zhimg.com/v2-3170e1c0e0336b2d5e0a9b44384f44cf_r.jpg)

所以本想着因为最近比较忙，就写个简单的内容，但实际自己在尝试以后，才发现其实还是有很多值得分享的知识点，主要有以下几个：

**1、粒子与克隆对象发生碰撞时的注意事项**

**2、发射器在高速运动的时候，如何解决粒子泄露的问题。**  

**3、摄像机晃动动画如何制作。**

**4、如何让“厚浪”变薄。**

好了，带着以上几个问题一起进入我们今天的小球泼水动画制作过程吧！

![](https://pic2.zhimg.com/v2-29972d51c8ff091e19931910625efd1d_r.jpg)

首先打开C4D，把帧速率改为25，这里我还是就做一个10秒的动画吧：

![](https://pic2.zhimg.com/v2-2e9c7bbcc064d62360667de887798b81_r.jpg)

首先新建一个小球，因为要用小球来碰撞，所以将类型改为二十面体比较好一点：

![](https://pic2.zhimg.com/v2-d95d9169e349ade61d858985d7aa75f5_r.jpg)

原图是一个椭圆的球，所以我这里给球体添加了一个膨胀变形器，匹配到父级以后收缩了一下：

![](https://pic3.zhimg.com/v2-01160a6f4f21c659e16ba0e123c93cb2_r.jpg)

**接下来是给小球做来回晃动的动画了，我尝试过用振动标签，但是有点生硬，并且我自己手K的功夫还不是太好。**

所以我这里选择的是一个讨巧的方法，首先新建一个圆环样条，调整它的尺寸和位置：

![](https://pic1.zhimg.com/v2-3bd53c4ad6d8cb950076e14c444ec8bc_r.jpg)

然后新建克隆对象克隆小球，以圆环为对象进行克隆，克隆数量1份，取消勾选固定克隆和排列克隆：

![](https://pic2.zhimg.com/v2-730bbfbb8d9c05f19448de8dd255d8e1_r.jpg)

再通过调整开始以及偏移的数值将小球调整到合适的位置以后进行K帧：

![](https://pic3.zhimg.com/v2-de004eccc578c790da328a41302dd79a_r.jpg)

这个K帧其实也是很容易控制的，只需要K偏移的关键帧就可以了。

**例如我的起始位置是75%，想要小球是正时针运动，你会发现当数值是-25%的时候是一个循环，也就是上一个数值减去100。**

于是我这里做的是每30帧一个循环，如此K了9个关键帧：

![](https://pic2.zhimg.com/v2-b1998242cc845b5abbb263a89c6b91f9_r.jpg)

需要额外注意的是，这个球体我们后面要作为发射器发射粒子，且粒子要和小球发生碰撞。

**而C4D的克隆对象与XP粒子发生碰撞是会出错的，这是由XP本身的碰撞引擎决定的：**

![](https://pic2.zhimg.com/v2-ff906f0b3c90290d36199622f72ee695_r.jpg)

**官方提出的解决方案有三个：**

1、C掉克隆对象。

2、使用“当前状态转为对象”命令，将克隆对象转换为一个可编辑对象。

3、给克隆添加一个xpJoin对象。

![](https://pic3.zhimg.com/v2-765dc473c1997e5b8ff64b1a4b554a36_r.jpg)

前面两种方法都不太好，至于这个xpJoin其实就相当于C4D的连接对象，所以我们这里就直接添加个连接，把所有对象都放在它的子集就行了：

![](https://pic3.zhimg.com/v2-37d858dd441c170e8633999f7c9c9b4a_r.jpg)

接下来新建发射器，以连接为对象进行发射，发射模式为六边形，只发射1帧就好，速度改为0，粒子半径我改成了2：

![](https://pic3.zhimg.com/v2-ba35c3beb551cb0e0ddaba8852cc419a_r.jpg)

给连接对象添加xp的碰撞标签，碰撞类型为内部，我关掉了反弹，略微给了一点摩擦力：

![](https://pic4.zhimg.com/v2-50642d917f6893f18bff5d50ed4ef4c3_r.jpg)

给场景中添加一个重力场，这个不用多说吧：

![](https://pic1.zhimg.com/v2-e023d70bdee00e07fd229e50375ac004_r.jpg)

现在的粒子是不具备流体形态的，所以添加一个xpFluidFX，参数都是默认的，仅仅勾选了检查密度：

![](https://pic1.zhimg.com/v2-9cc875dc12ba971200931c035a5c6c18_r.jpg)

这个时候你就会发现粒子泄露的很厉害：

![](https://pic4.zhimg.com/v2-12956ea2b2dc0f154ea39bc03b114ef7_r.jpg)

通常情况下遇到粒子泄露的问题我们都会去直接提高XP中的子帧步幅。

**提高这个参数确实可以减少粒子泄露的问题，但是如果数值高了首先模拟会很慢，并且会导致流体变硬或者变得粘稠，这可能不是我们想要的。**

而大家可以看到由于发射器在高速的运动，我这里把子帧步幅改到20泄露的情况依旧很严重：

![](https://pic3.zhimg.com/v2-b4074c6c7497d50f6d2484bf04f022a6_r.jpg)

因此当物体在高速运动的时候，只是简单的提高子帧步幅的方式是不可取的，我们可以这么操作一下，首先提高一下碰撞对象的分段：

![](https://pic3.zhimg.com/v2-81fa0a86538e0d3c6641e334fb58234a_r.jpg)

接下来再略微提高一下子帧步幅的参数，可以看到泄露出来的粒子明显变少了，并且由于只是略微提高了一点参数，所以流体的形态影响也不太大：

![](https://pic4.zhimg.com/v2-33c0cfaaf51b49221a4fd50926678acb_r.jpg)

但是现在还有泄露出来的粒子该怎么办呢，没关系，我们再新建一个粒子杀死场，把体积改为对象，把连接对象拖进去，杀死超出对象外的粒子就好了：

![](https://pic4.zhimg.com/v2-919dde3b00ddb2c73c89a7390ace29db_r.jpg)

粒子泄露的问题解决了，接下来给场景里添加一个湍流场，略微调整一下参数这个不用说哈：

![](https://pic4.zhimg.com/v2-57384a14c13c078f1b290a3fc5a10777_r.jpg)

新建一个立方体，添加显示标签以及碰撞标签，这个也不用说了哈：

![](https://pic1.zhimg.com/v2-eaf0e75f2b25820f60af0c425ebb7940_r.jpg)

接下来就是做泼水的动画了，其实很简单，在合适的位置给连接对象的碰撞标签K启用关键帧就好了，我这里选择的是125帧：

![](https://pic4.zhimg.com/v2-65bf7076af4d6eea5867612b8ba65ac7_r.jpg)

这里不要忘记要把杀死场的启用关键帧也K一下，水泼出去以后关掉杀死场：

![](https://pic1.zhimg.com/v2-78f0d8c1f7ece98fdf8983c91d024768_r.jpg)

基础液体我们就调整到这里，然后在发射器里我把显示改为了点，这样预览会稍微快一丢丢。

**另外由于我们不希望做出来的浪是厚浪，并且实际情况下，流体的速度越快，应该会越稀薄。**

所以我这里把颜色改为了黑白渐变色，这个黑白色后面能够用到，渐变的数据来源是速度，至于最大速度可以通过控制台来查看，我感觉2500应该差不多了：

![](https://pic4.zhimg.com/v2-b453eb2b97fb9273ee6218a01b98c2c7_r.jpg)

基础调整完毕以后还需要添加泡沫，所以添加泡沫生成器，同时创建一个泡沫发射器，发射器里我只修改了粒子的半径：

![](https://pic1.zhimg.com/v2-e2e9329478942e8652f98eda5e0a3af0_r.jpg)

泡沫生成器里的设置，空气率里控制的是粒子与粒子之间碰撞产生泡沫，我把它关掉了，只让粒子在波峰的时候产生。

泡沫的数量不要太多，所以波峰的范围控制在85%-90%的样子，然后让泡沫从第0帧就可以产生：

![](https://pic2.zhimg.com/v2-2390592ec6431f730f705da4ecaadbf5_r.jpg)

由于后面水泼出去的时候粒子速度很大，这里你会发现又有很多泡沫粒子会飞到立方体外面去：

![](https://pic1.zhimg.com/v2-6f7b12ec12bc66c8e4ed05329a1555c4_r.jpg)

没关系，再新建一个杀死场，把立方体做为体积拖进去，思路和前面是一样的，只是让它在125帧以后才启用：

![](https://pic3.zhimg.com/v2-162a830739e03a355c1da964bac3d6c2_r.jpg)

感觉差不多了就可以先将粒子缓存一次：

![](https://pic4.zhimg.com/v2-f59405bd50bc0e6f6f23536fe83b5bab_r.jpg)

缓存完毕以后，新建xpOVDBMesher，把基础的水粒子发射器拖进去，体素尺寸和点的半径适当调整就好：

![](https://pic2.zhimg.com/v2-35dc8bc1060facaf488fb3f269c97b11_r.jpg)

滤镜里面我没有启用，因为我觉得直接用C4D自己的平滑效果器也挺好，重点是在标签这里要勾选转换顶点颜色，这个时候就会创建一个顶点颜色标签：

![](https://pic1.zhimg.com/v2-3ea860fc9a4e9a96d83bcacb72b05c2c_r.jpg)

然后我们给网格添加一个置换变形器，在置换变形器里添加顶点贴图，你会看见网格会胖了一圈：

![](https://pic4.zhimg.com/v2-d09b7d0dd1f0fcb23d874b73cdf912ff_r.jpg)

这是因为直接添加顶点贴图它默认是一个纯白的图片，当我们把高度改为负数，这样所有的网格就都会瘦一圈：

![](https://pic4.zhimg.com/v2-1f47a2066dde0e4cc460f62f491e5f9f_r.jpg)

**因为我们之前设置粒子颜色的时候，粒子颜色是依据速度从黑到白。**

所以当我们把顶点颜色标签拖进顶点贴图栏位以后，就代表着速度越快的流体粒子颜色是白色会越薄，速度慢的流体粒子颜色是黑色就越厚：

![](https://pic4.zhimg.com/v2-e8a700866398d0f1c5b18d64140e973f_r.jpg)

再给网格添加平滑变形器，参数看着调整就好：

![](https://pic1.zhimg.com/v2-74ebd52d6b6abf762863cc4242137480_r.jpg)

缓存网格，只需要点击继续，就会在原有粒子缓存的基础上单独缓存网格：

![](https://pic4.zhimg.com/v2-c9a277706ce957aa2e8fb9693aa1484b_r.jpg)

缓存完毕以后记得要把两个变形器关掉，因为他们已经在缓存的时候计算过了，如果不关掉相当于又重复添加了两个变形器：

![](https://pic4.zhimg.com/v2-fac09eb5cc6ce5eea7f520c83ecbb403_r.jpg)

然后新建一个大大的平面这个不用说吧，因为我们后面材质要做出网格的纹路，所以分段可以多一点：

![](https://pic3.zhimg.com/v2-c0c3fbb66e37e429780c2bc8edb4ceda_r.jpg)

打开rs，新建环境光，渲染波浪一类的我个人觉得用天空的贴图会比较好：

![](https://pic4.zhimg.com/v2-8a6844782e3079b998750c330a7376d7_r.jpg)

网格的材质我直接用的rs预设的水的材质，取消勾选剔除内部反射：

![](https://pic4.zhimg.com/v2-9a0d58ee260645d60dc615f0a51c990b_r.jpg)

地面材质首先是一个深蓝色的反射材质：

![](https://pic2.zhimg.com/v2-a3927f03db191f5589c6ff70e4b2bc71_r.jpg)

新建一个线框节点，取消勾选显示隐藏边：

![](https://pic4.zhimg.com/v2-9fa2abd8007fd3bd068c21ea6f96d6ff_r.jpg)

然后把线框节点连接到凹凸节点上，凹凸模式改为对象空间法线，这样线框就有了：

![](https://pic2.zhimg.com/v2-0c3a66623f707110886c19ca96f7d2e5_r.jpg)

给泡沫粒子添加rs对象标签，模式为优化球体，尺寸可以小一点：

![](https://pic1.zhimg.com/v2-3534d894a3d2e701854c6a34b98dfa38_r.jpg)

再给粒子发射器添加一个rs材质球，材质球里使用用户数据节点获取粒子的颜色给漫射颜色端口：

![](https://pic1.zhimg.com/v2-136ed9409dabbdc6e5814ac29943f8f8_r.jpg)

感觉浪花有点偏黑，没关系，把全局光照打开就好了：

![](https://pic1.zhimg.com/v2-3e3a273e708bb69f25f1aee0db874718_r.jpg)

接下来就是制作晃动的摄像机动画了，首先新建一个RS的标准摄像机，固定好角度：

![](https://pic1.zhimg.com/v2-af3eb65232005e63ce0d4612b8c711f0_r.jpg)

然后再新建一个C4D运动摄像机：

![](https://pic1.zhimg.com/v2-514493e3a7d8e02d56eb76c471e55c48_r.jpg)

可以看到运动摄像机就会自动关联上rs的标准摄像机：

![](https://pic3.zhimg.com/v2-42def926bebdcbf1d5c8489d5eaf74b6_r.jpg)

运动摄像机标签里，在运动栏位可以选择一个预设，我这里选择的是Ego，这个时候播放摄像机就会晃动了：

![](https://pic4.zhimg.com/v2-0689cd8b620894ca7c53a5e80eebb00f_r.jpg)

然后我们可以让摄像机在水泼出去的时候逐渐停止晃动，只需要在强度上K关键帧就行了：

![](https://pic1.zhimg.com/v2-dc83b4b723ca3889ae1c56318dbbd97c_r.jpg)

接下来再通过K标准摄像机的参数让摄像机始终对着对象，这个大家多尝试一下吧：

![](https://pic4.zhimg.com/v2-a810d8478794da18c9af1a49348afa77_r.jpg)

视情况再补两盏灯吧：

![](https://pic1.zhimg.com/v2-7f08df0cd348c7bc277993757ac1d198_r.jpg)

渲染设置里我提高了全局光照的光线数量：

![](https://pic2.zhimg.com/v2-a57e3af8ed67b9a5504ac396d7c51889_r.jpg)

折射反射等次数我也提高了：

![](https://pic1.zhimg.com/v2-02be417c025d903148a959e1c25ae240_r.jpg)

同样提高了反射、折射、灯光以及统一采样：

![](https://pic3.zhimg.com/v2-7748afe9779ebccbc96deeb48b55457e_r.jpg)

渲染了8个多小时，时间方面总体来说还是能接受的：

![](https://pic3.zhimg.com/v2-5b86c3b220b08f0af23fbfad43ecc4ca_r.jpg)

最后后期加点运动模糊看看效果吧：

![](undefined)

好像渲染的不是很好看，不过今天的内容中需要注意的知识点还是挺多的，所以还是希望鹿友们尝试动手做一下，下面是今天的视频版：

[](https://www.zhihu.com/zvideo/1358521407291437056)

好啦，今天所有的内容就到这里，想要源文件以及原视频的童鞋后台**撩我**获取吧！

更多内容欢迎关注公众号：

公众号：野鹿志

老鹿微信：maluyelang6661

苦七微信：766057766

本文由“野鹿志”发布

转载前请联系马鹿野郎

私转必究