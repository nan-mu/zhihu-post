![](https://pic1.zhimg.com/v2-65de5f183e9174e7ab43ae977c53a3b8_r.jpg)

是这样的，这几天我在瞎弄OC的贴图的时候，突然弄出一个这种贴图来：

![](https://pic1.zhimg.com/v2-2874f4cf0e2e73563cbac8c992acfa58_r.jpg)

还记得我们之前分享过一篇使用TP粒子做的线条流淌效果么：

[](https://zhuanlan.zhihu.com/p/113371719)

我们当时是在着色效果器里添加噪波贴图，噪波贴图去影响矩阵对象的旋转，然后矩阵对象发射出TP粒子，再通过xpresso去获取TP粒子的旋转数据制作出来的。

**不过效果始终也不是漩涡状，当我通过OC得到这张贴图的时候，第一反应就是如果把噪波换成这个贴图，会不会就可以直接得到漩涡样条了呢？**

看来心里还是对这个漩涡效果有种蜜汁执着啊，加上最近上面提到的文章，已经写过三篇相关的内容了，但是都没有做好：

[](https://zhuanlan.zhihu.com/p/99480863)[](https://zhuanlan.zhihu.com/p/51525444)

于是兴致勃勃的把之前TP粒子那篇的工程文件拿来替换贴图进行尝试，结果失败了：

![](https://pic1.zhimg.com/v2-a28562de03b8af2315ae0d0030bb7a58_r.jpg)

**其实自己仔细想想失败也很正常，因为之前我们使用着色器添加噪波使用的是程序纹理，而现在我们加载的其实只是普通的一张2D贴图，贴图里并不包含方向等信息。**

那是不是2D的贴图就没办法包含方向信息了呢？其实不是的，之前我在学习RS的时候，由于RS对于贴图方面的操作要比OC麻烦，所以我专门去学习过关于贴图的相关知识。

**贴图里面的法线贴图就是用RGB三个通道来存储着方向信息的：**

![](https://pic2.zhimg.com/v2-48797d9c56891a82212229163a4096ed_r.jpg)

**既然我通过OC得到了这个一张灰度图，然后大家知道PS里是可以制作出法线贴图的，那如果有办法能够获取到法线贴图里的颜色信息，是不是就可以实现这个漩涡效果了呢？**

但是是否可行，具体怎么操作，我却不得而知，然后我想到了之前在写TP粒子文章的时候有鹿友留言推荐一位叫做**@飞舞的团子**的大神：

![](https://pic2.zhimg.com/v2-2ce7510d48189dee968acd1aa710e66d_r.jpg)

**这是一位会C4D python的硬核大神，和一般的教程不一样，他的内容大多都是程序化的使用C4D，感觉好神奇，对于xpresso或者C4D python感兴趣的鹿友强烈推荐去看看。**

看了团子大神的Tip\_13\_twirl这篇视频终于证实了我的想法是可行的，不过由于我个人不会编程，对于其中很多原理还是不太明白：

![](https://pic3.zhimg.com/v2-2168d46118feebacb9c44301ec5bf646_r.jpg)

所以把这个视频反复的看了好多遍，又查了很多资料，最后终于弄明白了。

**感觉也是时候给这个漩涡效果打个总结了，因此我今天想总结一下网上一共四种制作这种漩涡样条线的方法。**

前三种方法因为网上都很普遍了，我们就粗略过一下，然后最后团子大神的方法我们着重分享一下。

这里再次感谢**@飞舞的团子**大神的视频，终于让我能在R19不用插件预设，也不用编程的方式下做出了这个漩涡效果。

![](https://pic2.zhimg.com/v2-29972d51c8ff091e19931910625efd1d_r.jpg)

**1、使用R21域力场**

第一种方法是使用R21的新增功能域力场，如图所示新建一个平面：

![](https://pic3.zhimg.com/v2-75d307bfb257bc1d7a23c81b237ff696_r.jpg)

**我们都知道要让对象运动起来就需要速度，而速度是一个矢量，既有大小也有方向。**

R21的体积生成里新增了可以生成矢量这个功能，所以新建体积生成，让它成为平面的父级，体素类型改为矢量，尺寸可以稍微小一点：

![](https://pic4.zhimg.com/v2-f622ac9875902bbff51e54b433b95667_r.jpg)

在新建一个随机域让它成为体积生成的子集，这样随机域也能生成矢量：

![](https://pic4.zhimg.com/v2-cfd3dc7486cfa06852a48439be499337_r.jpg)

**但是默认情况下随机域的创建空间就是中间立方体那么大。**

我们回到体积生成，在对象栏位选中随机域以后，可以将创建空间改为对象以下，这样随机域就会根据平面的大小生成矢量：

![](https://pic4.zhimg.com/v2-e3c725f54b30d9313157035ee094e057_r.jpg)

这个时候我们再在模拟-力场里找到新增的域力场：

![](https://pic3.zhimg.com/v2-c0b8a235afc8a03aa55e6005abbd2a82_r.jpg)

再把体积生成拖给域力场，选择体积对象，域力场就会将体积对象生成的这些矢量转为力场：

![](https://pic4.zhimg.com/v2-112f7d5b9f8f14b24bda7de1a6a75873_r.jpg)

接下来就是要这些力场来影响TP粒子了，新建矩阵对象，以平面最为对象生成矩阵，改为TP粒子再将TP粒子群组拖进来，这些就不多说了哈：

![](https://pic1.zhimg.com/v2-0461667c0310a71cb1ef36909720b50c_r.jpg)

**默认情况下域力场不能直接影响TP粒子，所以新建一个xpresso标签，池里拖入粒子传递节点以及PForce对象节点。**

然后把粒子群组拖给粒子传递节点，把域力场拖给PForce对象节点，再将两个节点相连：

![](https://pic3.zhimg.com/v2-766810de2986ae3e4c34855ab97d4c1a_r.jpg)

为了方便观察，新建追踪对象追踪TP粒子群组，可以看到目前的运动轨迹不是我们想要的：

![](https://pic3.zhimg.com/v2-54f84e1188ba787f437a752e7677d61a_r.jpg)

没关系，回到体积生成里面，把随机域的混合模式改为穿过，让矢量紧贴在平面上：

![](https://pic3.zhimg.com/v2-195b02ae3ca93106c78ff73cf5c8e752_r.jpg)

域力场里我们将速率类型改为设置绝对速率，让速度直接受域力场影响，速度的数值可以大一点，这样雏形就有了：

![](https://pic4.zhimg.com/v2-e2f50f6c9e424b2d9362b6cf5842f7df_r.jpg)

接下来就是在随机域里改改尺寸：

![](https://pic2.zhimg.com/v2-9a0267bba5d1c129c22f54460caa0c1d_r.jpg)

最后再在追踪对象里改改样条类型和点差值方式等，基本就搞定了。

**因为有很多鹿友都没有用过R21的域力场，所以第一种方法我就稍微多写了一些：**

![](https://pic1.zhimg.com/v2-05b4d011b4fab4e3e3f5a3d84dbcd604_r.jpg)

总结：使用R21域力场这种方法制作的漩涡效果可控性很高，也可以制作出粒子在不同模型表面攀爬的效果，只可惜目前R21不支持和谐版的OC以及RS渲染。

**2、使用XP4.0**

这个方法就不用太多说了吧，新建一个方形的粒子发射器，速度改为0，就发射一帧粒子，然后添加拖尾：

![](https://pic2.zhimg.com/v2-586de42cb607f75b2489247c2043ace1_r.jpg)

新建一个湍流场，湍流类型改为卷曲，将对Y轴的影响取消勾选，这里最好把频率的数值改为0，这个漩涡的效果就出来了：

![](https://pic2.zhimg.com/v2-cd5ff9ed09150769fd54b13086489d99_r.jpg)

总结：使用XP4.0制作漩涡效果，简单快速，可控性高，C4D各个版本你都可以用，所以就不用在意渲染器的问题。

要说缺点嘛，当然就是得无论是正版还是离线版都得付费，要么就只有使用试用版。

3、使用python预设

第三种方法就是使用之前我们分享过的python预设来制作：

![](https://pic2.zhimg.com/v2-739678e78544ac7d96163d361017acc9_r.jpg)

总结：预设文件，简单无脑，基本没有什么可控性。

**4、使用贴图制作**

终于到了团子大神分享的方法了，要理解贴图制作这种方法我们首先需要理解两个重要的原理。

**首先法线的数值范围是-1到1，颜色的数值范围是0到1，法线通过RGB三个通道记录了方向的信息，红通道记录的是左右方向，绿通道记录的是上下方向，蓝通道记录的是前后方向。**

直接百度法线贴图的颜色就能够查看到相关资料：

![](https://pic2.zhimg.com/v2-9a9774f3d598062caa493bc94c077c9d_r.jpg)

其次第二个原理团子大神讲解的比较晦涩，我来回看了几遍想了半天还是没理解：

![](https://pic3.zhimg.com/v2-b27133aa33277a111dde12ba1d14a276_r.jpg)

刚好最近为了防止老年痴呆买了一个魔方：

![](https://pic1.zhimg.com/v2-34a70fb3e71cae30dd307a1de2fc6f4c_r.jpg)

在把玩的过程中突然明白了团子大神讲的含义，我这里以C4D的矩阵对象为例。

**当我手指按在左右方向如图所示的方块面上，想要整个魔方逆时针旋转，那么需要从下往上给一个力去改变方向：**

![](https://pic4.zhimg.com/v2-e140ddc02d42ac488e67ef2b85bf6b53_r.jpg)

而当我手指按在上下方向如图所示的方块面上，想要整个魔方逆时针旋转，则需要从左往右的一个力去改变方向，两者方向相反则是顺时针：

![](https://pic4.zhimg.com/v2-2506dee1bcd7f5213ccf21b5c2a4666f_r.jpg)

而我们前面也提到了，法线贴图的红通道是左右方向，绿通道是上下方向。

**因此我们只需要法线贴图的红通道从左往右、绿通道从下往上就可以让魔方形成一个逆时针的旋转：**

![](https://pic1.zhimg.com/v2-7f227a1c0121342e00d6941160351ecc_r.jpg)

切换到C4D透视面板，将对象换做一个平面，那就相当于是需要绿通道从下往上影响X轴，红通道从左往右影响Z轴，则平面进行逆时针旋转：

![](https://pic1.zhimg.com/v2-fc586d4f3aa5b9668ae504810af7708c_r.jpg)

**好了原理基本就是这样，后面我们边做的时候就能更加理解了。**

先做贴图吧，新建平面，新建环境光，新建一个材质拖给平面：

![](https://pic2.zhimg.com/v2-f25b6a8bfac398c8a0101e3eee16d419_r.jpg)

打开材质节点编辑器，先新建一个正弦波节点给漫射通道：

![](https://pic4.zhimg.com/v2-c4358422e38b92f08589e32cb3dfb24f_r.jpg)

再新建一个湍流节点连接到正弦波节点：

![](https://pic1.zhimg.com/v2-262469182d53c727aacfbc8c3cb6995c_r.jpg)

通过提高湍流节点里的power数值，就可以大概看到这种漩涡的图案了：

![](https://pic4.zhimg.com/v2-d1b521251284f93e4138fcd295e93cf7_r.jpg)

总之通过调整参数得到自己想要的状态，参数细节就不多说了，这个不是重点，调整完毕以后渲染一个方形的尺寸贴图出来就行：

![](https://pic3.zhimg.com/v2-c6f561c6efc2448507c6ecc0edb909e2_r.jpg)

做完以后再在PS里弄成法线贴图，这个也不用说吧：

![](https://pic1.zhimg.com/v2-d00a12e2fec14b25813c318eec76f84c_r.jpg)

回到C4D同样还是新建一个平面：

![](https://pic3.zhimg.com/v2-09111aaf77daf3663fb129fb5940cc7e_r.jpg)

新建材质球，颜色通道加载我们制作的法线贴图把它丢给平面：

![](https://pic4.zhimg.com/v2-4e340e915458101f4276cd63f8e85feb_r.jpg)

**注意我们之前不是提到了需要绿通道从下往上影响X轴，红通道从左往右影响Z轴么？**

现在的贴图方式是不对的，我们需要将投射方式改为平直，切换到纹理模式，可以看到纹理的XYZ三个轴向，我们这里可以简单的理解为对应着颜色的RGB三个通道：

![](https://pic3.zhimg.com/v2-9c1b66e1bfd926a7f2433c69734d323e_r.jpg)

因此我们将贴图的P轴旋转-90度，这样就是用贴图的绿通道从下往上影响X轴，红通道从左往右影响Z轴：

![](https://pic2.zhimg.com/v2-f2f79ecf5dd1795cda129f8bcb9067e9_r.jpg)

然后选中纹理鼠标右键适合对象：

![](https://pic1.zhimg.com/v2-23c598f1b8bd6bf76e8cf0c1c5eacf70_r.jpg)

**接下来这招也是跟团子大神学的，我们新建一个着色效果器，变换里任何参数都不要给，我们仅仅是用它来采样贴图的颜色信息。**

颜色模式记得开启，不要勾选Alpha通道，着色通道改为颜色通道，然后把材质球拖进来：

![](https://pic2.zhimg.com/v2-b9ebf44afa41abf603452549f1a7f049_r.jpg)

接下来新建矩阵对象，以平面发射TP粒子，把TP粒子组拖进来这一步不用说吧：

![](https://pic2.zhimg.com/v2-621bde15eb77ab23d2b7930b7205df01_r.jpg)

接下来新建xpresso标签，池里面新建粒子传递节点把TP粒子组拖进来，然后新建粒子数据获取节点，把它们连接上：

![](https://pic3.zhimg.com/v2-dc2559e0287000674512096c52b62fe6_r.jpg)

这里我们需要获取粒子的位置，所以输出端口添加一个位置端口：

![](https://pic4.zhimg.com/v2-32c784bf9173852dbbe3dce891ac28db_r.jpg)

这个粒子的位置我们需要通过贴图的颜色来定义，所以把着色效果器拖进池里，同时在运动图形里添加一个采样节点来采样着色器的颜色信息：

![](https://pic1.zhimg.com/v2-61ac2281b0fb65a7751028ab3ee0b480_r.jpg)

着色器的输出端口先添加一个对象端口，把它和采样节点连接上：

![](https://pic1.zhimg.com/v2-5413223db96f4a2b9a3aa027b579d22c_r.jpg)

同时我们还需要把粒子的位置信息和纹理的颜色关联起来，但是位置是一个矢量数据，而采样的输入端口是一个矩阵数据，鼠标悬停到输出端口可以看到他们的数据类型：

![](https://pic3.zhimg.com/v2-48fc81d9d25ff718d2b678eb3ee9e662_r.jpg)

所以我们需要一个矢量到矩阵的节点来进行转换，链接到偏移端口就行，其他三个端口是控制旋转的，这个以前的文章写过：

![](https://pic1.zhimg.com/v2-10390c98a4ad54fc687a95ce49822c70_r.jpg)

然后采样节点的输出端口我们把颜色端口调出来：

![](https://pic2.zhimg.com/v2-2c0401c477d93976dbb7d94217280ec9_r.jpg)

**现在我们需要去单独读取颜色的红绿通道，颜色是一个矢量数据，所以添加一个矢量到实数的节点来进行分离。**

然后再通过实数到矢量的节点再把红绿通道的信息合并起来，分离出来XYZ分别对应的就是RGB三个通道：

![](https://pic2.zhimg.com/v2-4c30687a251191313dd3c5892df6db6d_r.jpg)

**但是我们前面提到了颜色的范围是0到1，但是矢量的范围是-1到1，所以需要用范围映射节点来重新定义范围。**

新建范围映射节点，把X轴也就是红通道连给它，然后把输出下限改为-1就行了：

![](https://pic4.zhimg.com/v2-d6dd8508c0d2b24a0fa5ec46c09deb57_r.jpg)

Y轴也就是绿通道也是同样的道理，这里就不赘述了：

![](https://pic2.zhimg.com/v2-4436cf64dd05339c71b4e30ac8788b25_r.jpg)

接下来再通过实数到矢量节点把红绿通道合并，因为我们说了红通道是影响Z轴，绿通道影响X轴，所以如图所示连接：

![](https://pic1.zhimg.com/v2-6ce7ec0bcb943b1a8b43bbbaddf997f4_r.jpg)

接下来再添加粒子速率节点，输入端口添加方向：

![](https://pic1.zhimg.com/v2-9a541e1808d015a586ef8809f5881c30_r.jpg)

再把粒子传递以及方向的信息给连接上：

![](https://pic1.zhimg.com/v2-06f2d9d75e156c0f1b70839fb2980854_r.jpg)

给TP粒子添加追踪对象检测一下，漩涡的效果就出来了：

![](https://pic3.zhimg.com/v2-76225460d1b764b2da65bb7809664a6e_r.jpg)

如果你不希望线条跑出平面也是可以的，团子大神用的是预设。

**不过通过定义两个轴向上的最大最小范围，超出这个范围就杀死粒子的方法也是可行的，这个方法以前已经分享过了，这里就不赘述了：**

![](https://pic3.zhimg.com/v2-8c98f15337481a26b2530fff495f5282_r.jpg)

渲染今天不说了，篇幅已经60张图了，反正和渲染毛发是一样的，我觉得随便给一个渐变色都挺好看的：

![](https://pic3.zhimg.com/v2-ff2a0382e2afc1f355db36b9bd1cc3ba_r.jpg)

总结：最后一种方法的优势就是不用插件预设也能制作漩涡效果，由于我们可以换不同的贴图，所以具有一定的可控性。

但是理解起来需要花一些功夫，如果要制作不同模型表面攀爬的效果至少我没有找到方法。

![](https://pic2.zhimg.com/v2-29972d51c8ff091e19931910625efd1d_r.jpg)

终于写完了，四种方法大家就根据自己的需求来选择吧，下面是今天的视频版：

[](https://www.zhihu.com/zvideo/1299816090571886592)

好啦，今天的内容就到这里，想要源文件、原视频的童鞋后台**撩我**获取吧！

更多内容欢迎关注公众号

公众号：野鹿志

老鹿微信：maluyelang6661

苦七微信：766057766

本文由“野鹿志”发布

转载前请联系马鹿野郎

私转必究