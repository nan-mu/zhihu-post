![](https://pic1.zhimg.com/v2-e6fad86899dd277e9677a4f06eeb1dd0_r.jpg)

之前在Vimeo看到一个效果，觉得非常有意思：

![](https://pic4.zhimg.com/v2-310fe1be8eca09ac2d182c95d6d2ce87_r.jpg)

原作者**@Mark Fancher**是一位使用胡迪尼的大神，我把动画压缩成动图大家看看效果吧：

![](undefined)

这个效果好像叫做埃舍尔瀑布，有点类似于纪念碑谷的视觉错效果，从视觉上看起来流体是在一个平面上循环流动：

![](https://pic1.zhimg.com/v2-26377f9de510a8c9a50641f5d834466c_r.jpg)

**如果液体只是一个普通的水的材质其实还好，但原图里我个人觉得的难点是材质有波纹图案跟随液体流动，并且融合的几乎天衣无缝。**

其实我从年前就开始断断续续的在尝试制作这个效果了，由于我不会胡迪尼，所以只好用C4D尝试。

**前后差不多试了大半个月，也常和苦七讨论，估计苦七的内心os是：你还在研究这个效果啊？！**

过程中其实我走了很多冤枉路，先是尝试用realflow模拟流体，然后用oc制作出那个波纹的图案进行渲染，因此在这个尝试的过程中，有了上一篇小知识：

![](https://pic4.zhimg.com/v2-9919a69335354c2809730696fdf894a3_r.jpg)

后来测试出来的结果是虽然做出了波纹的图案，但是添加给网格以后，但是波纹图案没有办法随液体流动。

**原因我想可能是因为给网格添加纹理材质以后，网格其实是一个整体，而原图的波纹图案流动是由于液体之间挤压形成的。**

感兴趣的鹿友可以去测试一下，无论是改材质的投射方式或者将网格烘焙为点级别动画，波纹图案都不会随液体流动。

最后我换了一个思路，用xp来模拟流体，然后用rs渲染，大概做出了一个低配版的埃舍尔瀑布。

**好啦，今天我们就来看看这个低配版的埃舍尔瀑布是怎么制作的吧！**

![](https://pic2.zhimg.com/v2-29972d51c8ff091e19931910625efd1d_r.jpg)

开始之前先说一下我的思路：

1、首先我使用的是使用xp纹理发射粒子形成波纹图案，这样模拟流体的时候，粒子与粒子之间会挤压，纹理就会随着流动了。

2、在粒子的基础上，再添加网格，给网格水的材质，这样就有了一定液体的效果。

3、至于视觉错的效果，其实是用了两个发射器，一个发射器的液体正常在容器出口落下，另外一个在容器的起点上方发射粒子落下，然后和容器内的液体发生交互。

4、通过调整视角让两个发射器的液体角度基本重合，最后分别渲染后期在AE里用蒙板进行了合成。

**当然这么说起来好像挺简单，但是要做出完全融合还是很难的，各方面参数也要尝试很久，最后的结果其实并不是特别理想，不过我自己是已经尽力啦！**

![](https://pic2.zhimg.com/v2-29972d51c8ff091e19931910625efd1d_r.jpg)

首先我们需要制作出这么一个容器来，由于这个不是我们文章的重点，这里就不说制作的过程了，大家可以自己做或者直接拿我分享给大家的也可以：

![](https://pic2.zhimg.com/v2-17a53a616b9ab8f15366a6a98301d609_r.jpg)

先找一个合适的视角新建摄像机把视角固定住，这一步很重要，后面我们所有的调整都需要基于这个视角来做：

![](https://pic2.zhimg.com/v2-97a874cf692097ab1b98e94c9d0f3321_r.jpg)

选中容器里面的面执行网格-命令-分裂，把单独分裂出来作为发射粒子的面：

![](https://pic2.zhimg.com/v2-2156c34e8a27c5e193d3bc78331ab8a1_r.jpg)

新建材质球给面，取消勾选反射通道：

![](https://pic4.zhimg.com/v2-6297cadcbd9c8b4f64af7d57976435ff_r.jpg)

颜色通道里添加噪波，勾选绝对，适当提高周期的数值，就有波纹的效果了：

![](https://pic1.zhimg.com/v2-5397845f6b33d2214204ac2274259350_r.jpg)

但是现在首先有个问题是预览视窗里的贴图和渲染视窗里的贴图是不一致的：

![](https://pic4.zhimg.com/v2-df01d66f53c07e91e0c44a77fb3d8d57_r.jpg)

我们需要把空间改为uv二维，现在就一致了，但是投射方式肯定也是不对的：

![](https://pic3.zhimg.com/v2-8b6b38eb41dde5be30ed2eb0a3b5dee6_r.jpg)

回到纹理标签里，我们先把投射方式改为前沿，现在的纹理显示就是正常的了：

![](https://pic4.zhimg.com/v2-2fbf945427cfe284d04827eb815b07e3_r.jpg)

但是前沿这种投射方式纹理是没有被固定住的，所以需要删除原有的uvw标签，然后再点击纹理标签鼠标右键重新生成，这样纹理就固定住了：

![](https://pic1.zhimg.com/v2-f20204ed01980c020a0b97a5d8da38ac_r.jpg)

先给容器添加一个xp碰撞标签，将反弹关掉：

![](https://pic4.zhimg.com/v2-cdfc172b4a25ce562beea1ec60a26fb3_r.jpg)

新建一个粒子发射器，以刚才分裂出来的面为对象进行发射，发射模式为纹理发射：

![](https://pic3.zhimg.com/v2-b003efb063f33d3b75bcee8469af9dce_r.jpg)

纹理栏位把材质球拖进去，让粒子的颜色来源于材质的颜色通道：

![](https://pic4.zhimg.com/v2-390d491e23db170b3e04980ec7598cbf_r.jpg)

发射器的模式改为射击，让它每帧都发射1W个粒子，粒子的速度改为0，半径改为1：

![](https://pic1.zhimg.com/v2-62697d0a207d8760d679102356868740_r.jpg)

现在的粒子是不具备流体属性的，所以添加一个xpFluidPBD，参数都默认，我只是勾选了检查密度：

![](https://pic3.zhimg.com/v2-0bd57d860c55c5b2eb0a6c477c7d9a16_r.jpg)

再添加一个重力场，随着时间的推移，粒子就会从容器的出口自然下落：

![](https://pic3.zhimg.com/v2-1897d50fa52109ca46cc2d37b4e06ae2_r.jpg)

第一个粒子发射器我们先暂时这样，后面我们再看着效果调整，再次新建一个平面：

![](https://pic2.zhimg.com/v2-7eb38d2570a7fdc20d9b465f1f591951_r.jpg)

然后通过调整平面的大小高度以及位置，让它在透视视图中看起来刚好在容器出口的位置：

![](https://pic4.zhimg.com/v2-8609ff479aff86261bf3e126b18af647_r.jpg)

再次新建一个发射器，以平面做为对象进行发射，暂时先以多边形表面的模式进行发射：

![](https://pic3.zhimg.com/v2-a944204f066364f2886c13fc9da28f76_r.jpg)

发射器同样改为每帧都射击，速度改为0，粒子半径为1：

![](https://pic1.zhimg.com/v2-5e7ca19c81450b6f885dc2449b3220c0_r.jpg)

接下来就是枯燥无味的微调了，播放时间稍微长一点，主要观察两个水流的边界不能有太明显的距离：

![](https://pic4.zhimg.com/v2-ffb9ca0bde968341dcc5a8ed664cf7fb_r.jpg)

过程中你可能需要C掉平面去单独调整单边的长度，多试试吧，确实有点费劲：

![](https://pic1.zhimg.com/v2-421320a2378b8634b90e9e11a946552c_r.jpg)

然后在差不多的位置新建一个杀死场，干掉不需要部分的粒子：

![](https://pic1.zhimg.com/v2-d8d6781007c220baeeab3f90be2695cc_r.jpg)

把材质球给平面，同样删掉uvw标签，投射方式改为前沿以后重新生成：

![](https://pic2.zhimg.com/v2-7267d930e3b1d764f9471fc6816a0319_r.jpg)

发射器模式同样改为纹理发射，把材质球拖进去，让颜色基于颜色通道：

![](https://pic4.zhimg.com/v2-1816c00ff2e2661e3a730936f4c117f7_r.jpg)

然后现在有个问题是两个发射器发射出来下落的粒子都太过于稀疏了，即使你不断的提高粒子的数量也会很稀疏：

![](https://pic4.zhimg.com/v2-1cfb19f69f0faaea069141aed8338a87_r.jpg)

所以我这里使用的是xpSheeter，它可以在不增加粒子数量的情况下减少粒子与粒子之间的孔洞，首先我把发射器的粒子数量减少到了5000：

![](https://pic3.zhimg.com/v2-83489df6010501c1cd299d1463ea40d6_r.jpg)

然后在容器出口的位置添加xpSheeter，添加一个方形衰减，参数方面虽然不难理解但其实尝试起来也不太容易，我这里就只修改了最大密度和最小密度的参数：

![](https://pic1.zhimg.com/v2-78b03325f6aef51802003d863b123284_r.jpg)

感觉差不多了就在合适的位置把粒子状态设置为初始状态：

![](https://pic2.zhimg.com/v2-c9a1e0f085710017a229671e7d200bc9_r.jpg)

然后复制一个xpSheeter给另外一个发射器，略微的修改一下参数，让两个发射器发射出来的密度尽量匹配：

![](https://pic1.zhimg.com/v2-9b1668cda8b7767600e72d03ef26b118_r.jpg)

接下来先给A发射器添加xpOVDBMesher，数值大家看着调整就好：

![](https://pic4.zhimg.com/v2-458433365f33f61be76a65854c3bbe77_r.jpg)

现在的水面太平了，因为我们后面要做出波纹起伏的感觉，所以添加一个置换变形器，着色器里添加噪波，然后动画速率给一点参数：

![](https://pic3.zhimg.com/v2-9ad2358384ade5330924fcc04a45fe92_r.jpg)

置换的强度可以稍微低一点：

![](https://pic3.zhimg.com/v2-136921974451f65cb28839901cc6c556_r.jpg)

可以再给个平滑效果器，稍微平滑一下：

![](https://pic1.zhimg.com/v2-ba4bda853ac9f320e6bffea808baf7f0_r.jpg)

然后给B发射器也添加网格，这次就不添加置换效果器了，尽量让两个网格相似：

![](https://pic4.zhimg.com/v2-dde4898dd6da66b071afb474b6ea14bf_r.jpg)

需要注意的是现在两个网格是分别独立没有融合的，所以还需要再添加一个总的网格，把AB网格也拖进去，参数适当调整就好：

![](https://pic1.zhimg.com/v2-7576ef6e868f94ab4a033cd02aba790c_r.jpg)

通过网格大家可以明显看到B网格要宽一些，为了尽量让两个网格匹配，我这里又给两个发射器分别添加杀死场，目的就是为了修剪一下宽度：

![](https://pic1.zhimg.com/v2-88377a41c8b94670e46ceedd0d19c0c0_r.jpg)

然后又重新调整了一下网格的尺寸，唉，反正就是不停的微调吧：

![](https://pic1.zhimg.com/v2-a4883b73cdd85de298f1bdf6998cee64_r.jpg)

感觉差不多就可以缓存了，缓存时间半个多小时，还是能接受的：

![](https://pic4.zhimg.com/v2-4121cb68c8796d6f88d88a5c05c2bc5b_r.jpg)

接下来就是渲染部分了，新建一个环境光，给HDRI贴图，取消背景显示勾选透明通道：

![](https://pic1.zhimg.com/v2-c6c8a4657e74f542dfb71e61491ac68c_r.jpg)

环境光我这里旋转了180度：

![](https://pic1.zhimg.com/v2-869105b20c1438211113e92bc2a74744_r.jpg)

给粒子发射器添加RS对象标签，粒子里选择优化球体，由于近大远小的缘故，为了两个发射器的粒子尽量匹配，两个发射器粒子的尺寸我分别给的1和2：

![](https://pic3.zhimg.com/v2-d19641c60807f2bde9a08b5ffdaed1aa_r.jpg)

给发射器添加材质，材质节点里添加一个颜色数据节点，获取粒子的颜色：

![](https://pic1.zhimg.com/v2-227fe2be62ad2902443d1396a2746984_r.jpg)

再用一个渐变节点重新定义一下纹理的颜色：

![](https://pic1.zhimg.com/v2-fdfbd160ac1e42e71a14c7d87dafbe10_r.jpg)

网格的材质我就直接用的是RS的水的材质：

![](https://pic1.zhimg.com/v2-8a34bf4cc726d04171b8a85282ebebf0_r.jpg)

容器的材质是一个普通的深灰色反射材质：

![](https://pic3.zhimg.com/v2-60bbd7972bcbca8c6b809945739ee56a_r.jpg)

然后我在场景里补了一张红灯和蓝灯，工程里把模式改为包括，把容器拖进去，让灯光只对容器产生影响：

![](https://pic2.zhimg.com/v2-9dd0b46b278a7405b26f8a66368de371_r.jpg)

渲染设置方面我打开了全局光照：

![](https://pic1.zhimg.com/v2-4c80b2b295dc605e8b3f754d48a794ec_r.jpg)

反射以及折射深度都提高，同时把玻璃材质里的剔除内部反射取消勾选，这样水的材质感觉要亮一点：

![](https://pic1.zhimg.com/v2-a244a89f9bfdeff11f7fb3d0bfba45e0_r.jpg)

然后统一采样、反射、折射以及灯光的采样我都提高了：

![](https://pic3.zhimg.com/v2-e1d1ba00f105bb73b8ad4deecf13cfd6_r.jpg)

渲染的时候我们要渲染两次，首先是把两个发射器以及总网格渲染一次：

![](https://pic3.zhimg.com/v2-8200513b999a805290ac7c70e84e628a_r.jpg)

然后再把容器里的这个发射器以及网格渲染一次：

![](https://pic4.zhimg.com/v2-05d3b7600cf0d7229390e51fe081092f_r.jpg)

可能是因为统一采样稍微给高了点，渲染时间还挺长，单个渲染花了4个半小时，两个渲染合计就要9个多小时了：

![](https://pic4.zhimg.com/v2-45b94ef53d0c657541bedfdabb3d0387_r.jpg)

导入AE里，把容器里的这一层渲染放在总网格的上面：

![](https://pic2.zhimg.com/v2-6390abb4e40082771fd10a7b18152e21_r.jpg)

然后在容器渲染层合适的地方用钢笔画一个蒙板，模式改为相减：

![](https://pic2.zhimg.com/v2-ccfdbcd3eeac8b3446037d9da6e30845_r.jpg)

播放一下可以看到这个地方穿帮了：

![](https://pic2.zhimg.com/v2-06a8d33aa4a6b99145e8b84855f7d175_r.jpg)

通过提高蒙板的扩展以及羽化值就可以改善这种情况：

![](https://pic1.zhimg.com/v2-7990342f146145272ed4fefc28f0de74_r.jpg)

虽然看不太清楚，但是我觉得容器出口这里还是有一点穿帮：

![](https://pic3.zhimg.com/v2-cd263400db211a528dd7db01377a95d2_r.jpg)

于是我在总的网格渲染图层上又画了两个蒙板，然后再放一个容器层在底层，这个大家看着效果来吧：

![](https://pic1.zhimg.com/v2-8d1e7fda367ac63d538a9f2241eb7654_r.jpg)

最后简单调色加点运动模糊看看效果吧：

![](https://pic3.zhimg.com/v2-d81dcc549ca7b90bf802dd19f580958a_r.jpg)

唉，确实很低配，我不纠结啦，憋这个效果太久了，是时候放手啦，下面是今天的视频版：

[](https://www.zhihu.com/zvideo/1348219028826071040)

好啦，今天所有的内容就到这里，想要插件、源文件、原视频的童鞋后台**撩我**获取吧！

更多内容欢迎关注公众号：

公众号：野鹿志

老鹿微信：maluyelang6661

苦七微信：766057766

本文由“野鹿志”发布

转载前请联系马鹿野郎

私转必究